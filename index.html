<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.css" rel="stylesheet" media="all" crossorigin="anonymous">
    <link href="stylesheet.css" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <script src='https://cdn.plot.ly/plotly-2.4.2.min.js'></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxygen&display=swap" rel="stylesheet">
    <title>Breast CT Algorithm</title>
  </head>
  <body>
    <header>
      Breast CT Algorithm
      <h1 style="font-size: 25px"> Breast Implant Volume Calculator </h1>
    </header>
    <div class="row" style="margin: 10px; text-align: center">
      <p>This algorithm will determine breast implant volume based on CT-extracted measurements. <br>
        Fill in the fields below to get an estimation of volume.</p></div>
<div class="container">
  <div class="row">
        <div class="col-6">
            <form action="/action_page.php" method="post" class="form-container">
              <label for="axdim" class="label" id="axdimlabel"><b>Axial Diameter</b> in mm</label><br>
              <input type="text" placeholder="Axial Diameter" id="axdim" required><br>
              <label for="axproj" class="label" id="axprojlabel"><b>Axial Projection</b> in mm</label><br>
              <input type="text" placeholder="Axial Projection" id="axproj" required><br>
              <label for="sadim" class="label" id="sadimlabel"><b>Sagittal Diameter</b> in mm</label><br>
              <input type="text" placeholder="Sagittal Diameter" id="sadim" required><br>
              <label for="saproj" class="label" id="saprojlabel"><b>Sagittal Projection</b> in mm</label><br>
              <input type="text" placeholder="Sagital Projection" id="saproj" required>
              <label for="bmi" class="label"><b>Body-Mass-Index</b> (BMI) in kg/m2</label><br>
              <input type="text" placeholder="BMI" id="bmi" required><br>
            </form>
                <button type="submit" class="button" onclick="submit()">Calculate Volume</button>
                <button type="button" class="button" onclick="closeForm()">Cancel</button>
          </div>
      <div class="col-6">
        Results are shown here. Based on your input, the calculated volume is <br>
        <h1><span id='result'> 0 </span> cc</h1><br>
        Please consider this information about the provided information: <br>
        The algorithm used for volume prediction showed the following distribution of erroneous predictions:<br>
        <div id="chart-container" style="height: 200px"><canvas id="chart" style="width:100%; height:100%"></canvas><br>
        Prediction error in cc for mean (predicted volume) and anticipated error in standard deviations. Second row shows adjusted values to volume in question.</div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script type="text/javascript">
          var xlabels = [["-3 SD", "-132", ""], ["-2 SD", "-88", ""], ["-SD","-44", ""],["mean","± 0", ""], ["SD", "+44", ""], ["2 SD", "+88", ""], ["3SD", "+132", ""]];
          function plot (xlabels){
          var data = {labels: xlabels,
          datasets:[{
            backgroundColor: "rgba(255,99,132,0.2)",
            borderColor: "rgba(255,99,132,1)",
            borderWidth: 2,
            tension: 0.4,
            fill: true,
            data: [0, 0.5, 2, 7, 2, 0.5, 0]}
          ],
        }
          var options = {
            responsive: true,
            scales: {
              x: {display: true},
              y: {display: false},
            },
            plugins: {
              legend: {display: false},
            },
            tooltips: {
              enabled: false,
            }
          };

          new Chart('chart',{
            type:'line',
            options: options,
            data: data
          })
        }
        plot(xlabels);

        function rmdata(chart, xlabels) {
          chart.data.labels.pop();
          chart.data.labels.push(xlabels);
          chart.update();
        }
        </script>
        </div>
      </div>
      <script type="text/javascript">
        function closeForm() {
          alert('Cancelled!');
          document.getElementById('result').innerHTML = 0;
        }
        var volume = 0;
        function submit() {
          var axialdim = document.getElementById('axdim').value;
          var axialproj = document.getElementById('axproj').value;
          var bmindex = document.getElementById('bmi').value;
          var sagittaldim= document.getElementById('sadim').value;
          var sagittalproj= document.getElementById('saproj').value;
          var volume = 0;
          if (axialdim < 20) {
            document.getElementById("axdimlabel").style.color = 'red';
            alert("Axial Diameter is too low. Must be >20mm")
          } else if (axialdim > 200) {
            document.getElementById("axdimlabel").style.color = 'red';
            alert("Axial Diameter is too high. Must be <200mm")
          } else {
            calculatevolume ()
          }
          if (axialproj < 20) {
            document.getElementById("axprojlabel").style.color = 'red';
            alert("Axial Projection is too low. Must be >20mm")
          } else if (axialproj > 200) {
            document.getElementById("axprojlabel").style.color = 'red';
            alert("Axial Projection is too high. Must be <200mm")
          } else {
            calculatevolume ()
          }
          if (sagittaldim < 20) {
            document.getElementById("sadimlabel").style.color = 'red';
            alert("Sagittal Diameter is too low. Must be >20mm")
          } else if (sagittaldim > 200) {
            document.getElementById("sadimlabel").style.color = 'red';
            alert("Saggital Diameter is too high. Must be <200mm")
          } else {
            calculatevolume ()
          }
          if (sagittalproj < 20) {
            document.getElementById("saprojlabel").style.color = 'red';
            alert("Sagittal Projection is too low. Must be >20mm");
          } else if (sagittalproj > 200) {
            document.getElementById("saprojlabel").style.color = 'red';
            alert("Sagittal Projection is too high. Must be <200mm")
          } else {
            calculatevolume ()
          }
        function calculatevolume (){
          document.getElementById('axdimlabel').style.color='black';
          document.getElementById('axprojlabel').style.color='black';
          document.getElementById('sadimlabel').style.color='black';
          document.getElementById('saprojlabel').style.color='black';
          volume = -873.3+ (3.9* axialdim) +
          (4.0*axialproj) +(4.8*bmindex) +
          (3.0* sagittaldim) + (2.3* sagittalproj);
          if (volume < 0){
            alert("Values do not produce conclusive result. Please check input!");
            cancel()
          } else {
          document.getElementById('result').innerHTML= Math.round(volume);}
          document.getElementById('chart').remove();
          document.getElementById("chart-container").innerHTML="<canvas id='chart' style='width:100%; height:100%'></canvas><br>Prediction error in cc for mean (predicted volume) and anticipated error in standard deviations. Second row shows adjusted values to volume in question.";
          xlabels = [["-3 SD", "-132", Math.round(volume-132)], ["-2 SD", "-88", Math.round(volume-88)], ["-SD", "-44", Math.round(volume-44)],["mean", "± 0", Math.round(volume)], ["SD", "+44", Math.round(volume+44)], ["2 SD", "+88", Math.round(volume+88)], ["3SD", "+132", Math.round(volume+132)]];
          var data = {labels: xlabels,
          datasets:[{
            backgroundColor: "rgba(255,99,132,0.2)",
            borderColor: "rgba(255,99,132,1)",
            borderWidth: 2,
            tension: 0.4,
            fill: true,
            data: [0, 0.5, 2, 7, 2, 0.5, 0]}
          ],
        }
          var options = {
            responsive: true,
            scales: {
              x: {display: true},
              y: {display: false},
            },
            plugins: {
              legend: {display: false},
            },
            tooltips: {
              enabled: false,
            }
          };

          new Chart('chart',{
            type:'line',
            options: options,
            data: data
          })
        }
      }
      </script>
      <div class="row" style="margin: 10px">
        <p>This algorithm was created for research purposes and estimated outputs may deviate from actual values.</p> <br>
        <p>More information coming soon. <br>
        Please report bugs to clara.weber@yale.edu.</p><br>
        <p>Contributors: Kirby Mateja BS, Aaron S. Long BS, Sacha C. Hauc BS BA MPH, Adam Junn BS, Clara F Weber, Joshua Glahn BA, Hui Y. Juan BS, Pratheek S Bobba BS, Michael Alperovich MD MSc</p>
      </div>
      </div>
  <footer>
    <img src="logo.png" alt="" style="justify-content: center; width: 200px; vertical-align:center, justify-content: center; text-align: justify"><br>
    <p style="font-size: 10px; color: white">October 2021</p>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  </body>
</html>
